<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crci Score</title>

    <!-- link CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="api.css" />
  </head>
  <body>
    <h1 class="animated-line">
      <span class="sp" style="color: orange"></span> .
    </h1>

    <div class="mybtns">
      <div>
        <button type="button" class="sub btn btn-success">
          Get Score Updates
        </button>
      </div>
      <div>
        <button type="button" class="stp btn btn-danger">
          Stop Fetching score
        </button>
      </div>
    </div>

    <br />
    <div class="main"></div>

    <script>
      //   let arr1 = [];
      //   document.querySelector(".sub").addEventListener("click", function (e) {
      //     fetchScore();
      //     console.log(e.target);
      //   });

      // function fetchScore() {
      //     const requrl = "http://localhost:7575/cric/livescore";
      //     const xhr = new XMLHttpRequest();
      //     console.log(xhr.readyState); // 0 => request not initialised
      //     xhr.open("GET", requrl);
      //     console.log(xhr.readyState); //1 => server connection established
      //     console.log(xhr.readyState); //1 => server connection established
      //     xhr.onreadystatechange = function () {
      //       console.log(xhr.readyState);
      //       if (xhr.readyState === 4) {
      //          const data = JSON.parse(this.responseText);
      //          console.log(typeof data);
      //          console.log(data);

      //         //iterating through the data object
      //          console.log("//iterating through the data object");

      //         data.forEach((na) => {
      //             if (!arr1.includes(na.matchID)) {
      //             arr1.push(na.matchID);
      //             //agar matchid present nahi hogi to new elemnts bnvao or vo match ko usme daldo...
      //             console.log("function creating is called");
      //             createnewElements(na);
      //             }
      //             else {
      //             //nahi to bss update kro...

      //             console.log( ` arr1 : ${arr1}`);

      //             document.querySelector("#li1").innerHTML = na.teamHeading;
      //             // let l1 = document.querySelector("#li1");
      //             // l1.innerHTML = na.teamHeading;
      //             document.querySelector("#li2").innerHTML = na.battingTeam;
      //             document.querySelector("#li3").innerHTML = na.textComplete;
      //             document.querySelector("#li4").innerHTML = na.matchNoVenue;
      //             document.querySelector("#li5").innerHTML = na.matchID;
      //             document.querySelector("#li6").innerHTML = na.bowlingTeam;
      //             document.querySelector("#li7").innerHTML = na.battingTeamScore;
      //             document.querySelector("#li8").innerHTML = na.bowlingTeamScore;
      //           }
      //         });
      //       }

      //     };

      //     xhr.send();
      //     console.log(xhr.readyState); //1 => server connection established
      //   } //fetch score

      //   let mainTask = setInterval(fetchScore, 3000);
      //   //   }); //event listener end

      //   //   setInterval(fetchScore,3000);

      //   function createnewElements(na) {
      //     let main = document.querySelector(".main");
      //     let newdiv = document.createElement("div");
      //     //setting style for newdiv

      //     newdiv.style.border = "solid #242424 3px"; // Solid border
      //     newdiv.style.height = "100%"; // Fixed height
      //     newdiv.style.width = "300px"; // Fixed width
      //     newdiv.style.padding = "15px"; // Padding inside the div
      //     newdiv.style.borderRadius = "10px"; // Rounded corners
      //     newdiv.style.boxShadow = "5px 5px 15px rgba(0, 0, 0, 0.5)"; // Shadow effect
      //     newdiv.style.backgroundColor = "#f9f9f9"; // Light background color for showcase effect
      //     newdiv.style.margin = "10px auto"; // Centering div with margin

      //     let newul = document.createElement("ul");

      //     let newli1 = document.createElement("li");
      //     // newli1.classList.add("li1");
      //     newli1.id = "li1";
      //     newli1.style.fontWeight = "bold";

      //     let newli2 = document.createElement("li");
      //     // newli2.classList.add("li2");
      //     newli2.id = "li2";
      //     let newli3 = document.createElement("li");
      //     // newli3.classList.add("li3");
      //     newli3.id = "li3";
      //     let newli4 = document.createElement("li");
      //     // newli4.classList.add("li4");
      //     newli4.id = "li4";
      //     let newli5 = document.createElement("li");
      //     // newli5.classList.add("li5");
      //     newli5.id = "li5";
      //     let newli6 = document.createElement("li");
      //     // newli6.classList.add("li6");
      //     newli6.id = "li6";
      //     let newli7 = document.createElement("li");
      //     // newli7.classList.add("li7");
      //     newli7.id = "li7";
      //     let newli8 = document.createElement("li");
      //     // newli8.classList.add("li8");
      //     newli8.id = "li8";

      //     // newli1.innerHTML = `<h2>${na.teamHeading}</h2>`;
      //     newli1.textContent = na.teamHeading;
      //     newli2.innerHTML = na.battingTeam;
      //     newli3.innerHTML = na.textComplete;
      //     newli4.innerHTML = na.matchNoVenue;
      //     newli5.innerHTML = na.matchID;
      //     newli6.innerHTML = na.bowlingTeam;
      //     newli7.innerHTML = na.battingTeamScore;
      //     newli8.innerHTML = na.bowlingTeamScore;

      //     newul.appendChild(newli1);
      //     newul.appendChild(newli2);
      //     newul.appendChild(newli3);
      //     newul.appendChild(newli4);
      //     newul.appendChild(newli5);
      //     newul.appendChild(newli6);
      //     newul.appendChild(newli7);
      //     newul.appendChild(newli8);

      //     newdiv.appendChild(newul);

      //     main.appendChild(newdiv);
      //   }

      //   fetchScore(); //calling initaillaly

      //   document.querySelector(".stp").addEventListener("click", function () {
      //     clearInterval(mainTask);
      //   });

      let arr1 = [];
      document.querySelector(".sub").addEventListener("click", function (e) {
        fetchScore();
        console.log(e.target);
      });

      function fetchScore() {
        const requrl = "http://localhost:7575/cric/livescore";
        const xhr = new XMLHttpRequest();
        console.log(xhr.readyState); // 0 => request not initialised
        xhr.open("GET", requrl);
        console.log(xhr.readyState); //1 => server connection established

        xhr.onreadystatechange = function () {
          console.log(xhr.readyState);
          if (xhr.readyState === 4) {
            const data = JSON.parse(this.responseText);
            console.log(typeof data);
            console.log(data);

            // Iterate through the data object
            console.log("//iterating through the data object");

            data.forEach((na) => {
              if (!arr1.includes(na.matchID)) {
                arr1.push(na.matchID);
                // Create new elements if matchID is not present
                console.log("function creating is called");
                createnewElements(na);
              } else {
                // Update existing elements using a unique selector
                console.log(` arr1 : ${arr1}`);

                const existingDiv = document.querySelector(
                  `.match-${na.matchID}`
                );
                if (existingDiv) {
                  existingDiv.querySelector(".teamHeading").innerHTML =
                    na.teamHeading;
                  existingDiv.querySelector(".battingTeam").innerHTML =
                    na.battingTeam;
                  existingDiv.querySelector(".textComplete").innerHTML =
                    na.textComplete;
                  existingDiv.querySelector(".matchNoVenue").innerHTML =
                    na.matchNoVenue;
                  existingDiv.querySelector(".matchID").innerHTML = na.matchID;
                  existingDiv.querySelector(".bowlingTeam").innerHTML =
                    na.bowlingTeam;
                  existingDiv.querySelector(".battingTeamScore").innerHTML =
                    na.battingTeamScore;
                  existingDiv.querySelector(".bowlingTeamScore").innerHTML =
                    na.bowlingTeamScore;
                }
              }
            });
          }
        };

        xhr.send();
        console.log(xhr.readyState); //1 => server connection established
      }

      let mainTask = "";
      document.querySelector(".sub").addEventListener("click", function (e) {
        console.log("Start button is triggered");
        mainTask = setInterval(fetchScore, 3000);
      });

      document
        .querySelector(".mybtns .btn-danger")
        .addEventListener("click", function () {
          console.log("Stop button is triggered");
          clearInterval(mainTask);
        });

      function createnewElements(na) {
        let main = document.querySelector(".main");
        let newdiv = document.createElement("div");

        // Assign a unique class to identify the match
        newdiv.className = `match-${na.matchID}`;

        // Styling and structure remain the same
        newdiv.style.border = "solid #242424 3px";
        newdiv.style.height = "300px";
        newdiv.style.width = "300px";
        newdiv.style.padding = "15px";
        newdiv.style.borderRadius = "10px";
        newdiv.style.backgroundColor = "#f9f9f9";
        newdiv.style.margin = "10px auto";
        //Style
        newdiv.style.boxShadow =
          "0 8px 16px rgba(0, 0, 0, 0.2), 0 6px 20px rgba(0, 0, 0, 0.19)";
        newdiv.style.transition = "transform 0.3s ease, box-shadow 0.3s ease"; // Smooth transition

        // Add hover effect using JavaScript (optional if not using CSS)
        newdiv.addEventListener("mouseover", function () {
          newdiv.style.transform = "scale(1.05)"; // Slight zoom effect
          newdiv.style.boxShadow =
            "0 12px 24px rgba(0, 0, 0, 0.3), 0 8px 30px rgba(0, 0, 0, 0.25)"; // Darker shadow on hover
        });

        newdiv.addEventListener("mouseout", function () {
          newdiv.style.transform = "scale(1)"; // Reset zoom
          newdiv.style.boxShadow =
            "0 8px 16px rgba(0, 0, 0, 0.2), 0 6px 20px rgba(0, 0, 0, 0.19)"; // Reset shadow
        });
        //Style

        let newul = document.createElement("ul");

        // Create list items with unique classes
        newul.innerHTML = `
    <li class="teamHeading" style="font-weight: bold;">${na.teamHeading}</li>
    <li class="battingTeam">${na.battingTeam}</li>
    <li class="textComplete">${na.textComplete}</li>
    <li class="matchNoVenue">${na.matchNoVenue}</li>
    <li class="matchID">${na.matchID}</li>
    <li class="bowlingTeam">${na.bowlingTeam}</li>
    <li class="battingTeamScore">${na.battingTeamScore}</li>
    <li class="bowlingTeamScore">${na.bowlingTeamScore}</li>
  `;

        newdiv.appendChild(newul);
        main.appendChild(newdiv);
      }

      fetchScore(); // calling initially
    </script>
  </body>
</html>
